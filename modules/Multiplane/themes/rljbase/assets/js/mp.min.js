(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.MP=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){var d=document,MP=require("./mp/MP.js"),Cookie=require("./mp/Cookie.js"),Video=require("./mp/SimpleVideo.js"),Privacy=require("./mp/Privacy.js");MP.on("privacy",function(e){if(e.params.type&&e.params.type=="external_video"&&e.params.target){if(Cookie.get("loadExternalVideos")=="1"){Video.loadVideo(e.params.target)}else{Privacy.displayPrivacyNotice(e.params)}}});MP.convertVideoLinksToIframes=function(){Video.convertVideoLinksToIframes()};MP.replaceVideoLink=function(){Video.replaceVideoLink()};MP.Cookie=Cookie;MP.Carousel=require("./mp/SimpleCarousel.js");MP.Lightbox=require("./mp/SimpleLightbox.js");MP.Video=Video;MP.Privacy=Privacy;module.exports=MP},{"./mp/Cookie.js":2,"./mp/MP.js":3,"./mp/Privacy.js":4,"./mp/SimpleCarousel.js":5,"./mp/SimpleLightbox.js":6,"./mp/SimpleVideo.js":7}],2:[function(require,module,exports){var g=window,d=document;module.exports={lifeTime:"30",set:function(key,value,lifeTime){if(!key||!value&&value!=0)return;if(!lifeTime&&lifeTime!=0)lifeTime=this.lifeTime;var expirationDate=new Date;expirationDate.setTime(expirationDate.getTime()+lifeTime*864e5);d.cookie=key+"="+value+";expires="+expirationDate.toUTCString()+"; path=/"},get:function(key){if(d.cookie=="")return;var cockie=d.cookie.split("; ").reduce(function(result,pairStr){var arr=pairStr.split("=");if(arr.length===2){result[arr[0]]=arr[1]}return result},{});return key?cockie[key]:cockie},destroy:function(key){this.set(key,"",0)}}},{}],3:[function(require,module,exports){var d=document;if(!(window.Promise&&window.FormData)&&typeof MP_POLYFILLS_URL!="undefined"){var js=d.createElement("script");js.src=MP_POLYFILLS_URL;d.head.appendChild(js)}module.exports={base_route:typeof MP_BASE_URL!="undefined"?MP_BASE_URL:"",base_url:typeof MP_BASE_URL!="undefined"?MP_BASE_URL:"",_events:{},route:function(url){return this.base_route+url},ready:function(fn){if(d.readyState!="loading"){fn()}else if(d.addEventListener){d.addEventListener("DOMContentLoaded",fn)}else{d.attachEvent("onreadystatechange",function(){if(d.readyState!="loading")fn()})}},visible:function(fn,fm){var stateKey,eventKey,keys={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(stateKey in keys){if(stateKey in d){eventKey=keys[stateKey];break}}if(typeof fn=="function"&&typeof fm=="function"){d.addEventListener(eventKey,function(){if(!d[stateKey])fn();else fm()})}else if(typeof fn=="function"){d.addEventListener(eventKey,function(){fn()})}return!d[stateKey]},request:function(url,data,type){url=this.route(url);type=type||"json";return new Promise(function(fulfill,reject){var xhr=new XMLHttpRequest;xhr.open("post",url,true);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");url+=(url.indexOf("?")!==-1?"&":"?")+"nc="+Math.random().toString(36).substr(2);if(data){if(typeof data==="object"&&data instanceof HTMLFormElement){data=new FormData(data)}else if(typeof data==="object"&&data instanceof FormData){}else if(typeof data==="object"){xhr.setRequestHeader("Content-Type","application/json; charset=UTF-8");data=JSON.stringify(data||{})}}xhr.onloadend=function(){var resdata=xhr.responseText;if(type=="json"){try{resdata=JSON.parse(xhr.responseText)}catch(e){resdata=null}}if(this.status==200){fulfill(resdata,xhr)}else{reject(resdata,xhr)}};xhr.send(data)})},on:function(name,fn){if(!this._events[name])this._events[name]=[];this._events[name].push(fn)},off:function(name,fn){if(!this._events[name])return;if(!fn){this._events[name]=[]}else{for(var i=0;i<this._events[name].length;i++){if(this._events[name][i]===fn){this._events[name].splice(i,1);break}}}},trigger:function(name,params){if(!this._events[name])return;var event={name:name,params:params};for(var i=0;i<this._events[name].length;i++){this._events[name][i].apply(MP,[event])}}}},{}],4:[function(require,module,exports){var d=document,MP=require("./MP.js"),Cookie=require("./Cookie.js");module.exports={modal:d.getElementById("privacy-notice"),active:false,lastFocus:null,displayPrivacyNotice:function(params){var $this=this,target=params.target||d.activeElement,form=d.getElementById("privacy-notice-form");this.lastFocus=target,this.show();form.addEventListener("submit",function(e){if(e)e.preventDefault();var data=new FormData(form),entries=data.entries(),entry=entries.next();while(!entry.done){Cookie.set(entry.value[0],entry.value[1]);entry=entries.next()}MP.trigger("privacy",{type:params.type,target:target});$this.hide()});form.addEventListener("reset",function(e){$this.hide()})},show:function(){var $this=this;this.active=true;this.modal.style.display="block";this.modal.tabIndex=-1;this.modal.setAttribute("role","dialog");this.modal.focus();d.addEventListener("focus",function(e){if($this.active&&!$this.modal.contains(e.target)){e.stopPropagation();$this.modal.focus()}},true)},hide:function(){this.active=false;this.modal.style.display="";this.lastFocus.focus()}}},{"./Cookie.js":2,"./MP.js":3}],5:[function(require,module,exports){var g=window,d=document;MP=require("./MP.js");module.exports={selector:"",carousels:[],autoplay:true,duration:15e3,init:function(options){var $this=this;if(options){if(typeof options=="string"){this.selector=options}else{Object.keys(options).forEach(function(k){$this[k]=options[k]})}}else{return}Array.prototype.forEach.call(d.querySelectorAll(this.selector),function(node,k){$this.carousels.push({paused:false,node:node,interval:null})});if(!this.carousels.length)return;Array.prototype.forEach.call(this.carousels,function(carousel,k){var pauseButton=d.createElement("a");pauseButton.setAttribute("href","#");pauseButton.classList.add("icon-pause");pauseButton.setAttribute("aria-label","start/stop image carousel");pauseButton.tabIndex=0;carousel.node.appendChild(pauseButton);g.addEventListener("resize",function(){carousel.node.style.height=carousel.node.children[0].offsetHeight+"px"});g.addEventListener("load",function(){var event;if(typeof Event==="function"){event=new Event("resize")}else{event=d.createEvent("Event");event.initEvent("resize",true,true)}g.dispatchEvent(event)});carousel.node.addEventListener("click",function(e){if(e)e.preventDefault();carousel.paused=!carousel.paused;if(carousel.paused){pauseButton.classList.remove("icon-pause");pauseButton.classList.add("icon-play");$this.pause(carousel)}else{pauseButton.classList.remove("icon-play");pauseButton.classList.add("icon-pause");$this.play(carousel)}});MP.visible(function(){$this.play(carousel)},function(){$this.pause(carousel)});if($this.autoplay&&!carousel.paused){$this.play(carousel)}})},play:function(carousel){if(carousel.paused)return false;if(!carousel.interval){carousel.interval=this.animate(carousel)}return carousel.interval},pause:function(carousel){window.clearInterval(carousel.interval);carousel.interval=false},animate:function(carousel){var intervalId=setInterval(function(){var current=carousel.node.querySelector(".current");var next=current.nextElementSibling;if(!next||next.nodeName=="A")next=carousel.node.firstElementChild;if(next.getAttribute("src")=="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"){next.setAttribute("src",next.dataset.src)}current.classList.remove("current");next.classList.add("current")},this.duration);return intervalId}}},{"./MP.js":3}],6:[function(require,module,exports){var d=document;module.exports={selector:"",group:null,active:false,currentItem:null,currentGallery:null,galleries:[],captions:[],img:d.createElement("img"),lightbox:d.createElement("div"),wrap:d.createElement("div"),caption:d.createElement("div"),closeButton:d.createElement("a"),prevButton:d.createElement("a"),nextButton:d.createElement("a"),lastFocus:null,init:function(options){var $this=this;if(options){if(typeof options=="string"){this.selector=options}else{Object.keys(options).forEach(function(k){$this[k]=options[k]})}}else{return}this.lightbox.setAttribute("class","lightbox");this.lightbox.setAttribute("role","dialog");this.lightbox.setAttribute("aria-hidden","true");this.lightbox.tabIndex=-1;d.querySelector("body").appendChild(this.lightbox);this.prevButton.setAttribute("href","#");this.nextButton.setAttribute("href","#");this.closeButton.setAttribute("href","#");this.prevButton.setAttribute("aria-label","previous");this.nextButton.setAttribute("aria-label","next");this.closeButton.setAttribute("aria-label","close");this.prevButton.classList.add("prev");this.nextButton.classList.add("next");this.closeButton.classList.add("icon-close");this.lightbox.appendChild(this.wrap);this.lightbox.appendChild(this.prevButton);this.lightbox.appendChild(this.nextButton);this.lightbox.appendChild(this.closeButton);this.wrap.appendChild(this.img);if(this.group){var groups=d.querySelectorAll(this.group);Array.prototype.forEach.call(groups,function(el,i){$this.galleries.push(el.querySelectorAll($this.selector))})}else{this.galleries.push(d.querySelectorAll(this.selector))}Array.prototype.forEach.call(this.galleries,function(gallery,k){$this.captions[k]={};Array.prototype.forEach.call(gallery,function(el,i){el.addEventListener("click",function(e){if(e)e.preventDefault();$this.lastFocus=el||d.activeElement;$this.active=true;$this.currentItem=i;$this.currentGallery=k;$this.update()});var node=el.parentNode.querySelector("figcaption");if(node){$this.captions[k][i]=node.innerHTML}else if(el.getAttribute("title")){$this.captions[k][i]=el.getAttribute("title")}else if(el.dataset.title){$this.captions[k][i]=el.dataset.title}})});this.prevButton.addEventListener("click",function(e){if(e){e.preventDefault();e.stopPropagation()}$this.prev(e)});this.nextButton.addEventListener("click",function(e){if(e){e.preventDefault();e.stopPropagation()}$this.next(e)});this.closeButton.addEventListener("click",function(e){if(e)e.preventDefault()});this.lightbox.addEventListener("click",function(e){if(e&&e.target.nodeName=="IMG"){return}$this.close(e)});d.addEventListener("focus",function(e){if($this.active&&!$this.lightbox.contains(e.target)){e.stopPropagation();$this.lightbox.focus()}},true);d.addEventListener("keydown",function(e){if($this.active){if(e.keyCode==37)$this.prev(e);if(e.keyCode==39)$this.next(e);if(e.keyCode==27)$this.close(e)}})},update:function(){if(!this.active){this.lightbox.classList.remove("active");this.lightbox.setAttribute("aria-hidden","true");this.lastFocus.focus();return}this.lightbox.classList.add("active");this.lightbox.focus();if(this.currentItem==0){this.prevButton.classList.add("hidden")}else this.prevButton.classList.remove("hidden");if(this.currentItem==this.galleries[this.currentGallery].length-1){this.nextButton.classList.add("hidden")}else this.nextButton.classList.remove("hidden");this.img.setAttribute("src",this.galleries[this.currentGallery][this.currentItem].getAttribute("href"));if(this.captions[this.currentGallery][this.currentItem]){this.caption.innerHTML=this.captions[this.currentGallery][this.currentItem];this.wrap.appendChild(this.caption)}else if(this.wrap.contains(this.caption)){this.wrap.removeChild(this.caption)}},prev:function(e){if(this.galleries[this.currentGallery][this.currentItem-1]){this.currentItem-=1;this.update()}},next:function(e){if(this.galleries[this.currentGallery][this.currentItem+1]){this.currentItem+=1;this.update()}},close:function(e){this.active=false;this.update()}}},{}],7:[function(require,module,exports){var d=document,MP=require("./MP.js");module.exports={convertVideoLinksToIframes:function(){var $this=this,video_links=d.querySelectorAll("a[data-video-id]");Array.prototype.forEach.call(video_links,function(el,i){var id=el.getAttribute("data-video-id"),provider=el.getAttribute("data-video-provider"),asset=el.getAttribute("data-video-thumb"),width=480,height=370,ratio="",thumb="",src="";if((data_width=el.getAttribute("data-video-width"))&&(data_height=el.getAttribute("data-video-height"))){height=width*(data_height/data_width);ratio=data_width/data_height==16/9?"16-9":"4-3"}if(asset.indexOf("http")==0||asset.indexOf(".")!=-1){thumb=asset}else{thumb=MP.base_url+"/getImage?src="+asset+"&w=480&o=1"}if(provider=="youtube"){ratio="16-9";src="https://www.youtube-nocookie.com/embed/"+id+"?enablejsapi=1&rel=0&showinfo=0&autoplay=1"}if(provider=="vimeo"){src="https://player.vimeo.com/video/"+id+"?color=ffffff&title=0&byline=0&portrait=0&autoplay=1"}var container=d.createElement("div");container.classList.add("video_embed_container");container.classList.add("ratio-"+ratio);var iframe=d.createElement("iframe");iframe.classList.add("video_embed");iframe.setAttribute("width",width);iframe.setAttribute("height",height);iframe.setAttribute("src","about:blank");iframe.setAttribute("data-src",src);iframe.setAttribute("data-provider",provider);iframe.setAttribute("src","about:blank");iframe.setAttribute("allow","autoplay; fullscreen");iframe.setAttribute("allowfullscreen","");iframe.style["background-image"]="url("+thumb+")";if(!iframe.getAttribute("id")){iframe.setAttribute("id","player_"+Math.random().toString(36).substring(2))}iframe.tabIndex=-1;container.appendChild(iframe);var play_button=d.createElement("a");play_button.setAttribute("class","icon-play");play_button.setAttribute("href","#");play_button.tabIndex=0;container.appendChild(play_button);el.parentNode.insertBefore(container,el);play_button.addEventListener("click",function(e){if(e)e.preventDefault();MP.trigger("privacy",{type:"external_video",target:iframe})})})},replaceVideoLink:function(){var $this=this,video_links=d.querySelectorAll(".video_embed");Array.prototype.forEach.call(video_links,function(iframe,i){iframe.tabIndex=-1;if(!iframe.getAttribute("id")){iframe.setAttribute("id","player_"+Math.random().toString(36).substring(2))}var play_button=iframe.nextElementSibling;play_button.addEventListener("click",function(e){if(e)e.preventDefault();MP.trigger("privacy",{type:"external_video",target:iframe})})})},loadVideo:function(iframe){var $this=this,id=iframe.getAttribute("id");volume=iframe.dataset.volume||50;iframe.focus();iframe.removeAttribute("tabindex");iframe.setAttribute("src",iframe.getAttribute("data-src"));iframe.style["background-image"]="";if(iframe.dataset.provider=="youtube"){this.callPlayer(id,function(){$this.callPlayer(id,"setVolume",[volume,true]);$this.callPlayer(id,"playVideo")})}},callPlayer:function(frame_id,func,args){var $this=this;if(window.jQuery&&frame_id instanceof jQuery)frame_id=frame_id.get(0).id;var iframe=document.getElementById(frame_id);if(iframe&&iframe.tagName.toUpperCase()!="IFRAME"){iframe=iframe.getElementsByTagName("iframe")[0]}if(!this.callPlayer.queue)this.callPlayer.queue={};var queue=this.callPlayer.queue[frame_id],domReady=document.readyState=="complete";if(domReady&&!iframe){window.console&&console.log("callPlayer: Frame not found; id="+frame_id);if(queue)clearInterval(queue.poller)}else if(func==="listening"){if(iframe&&iframe.contentWindow){func='{"event":"listening","id":'+JSON.stringify(""+frame_id)+"}";iframe.contentWindow.postMessage(func,"*")}}else if((!queue||!queue.ready)&&(!domReady||iframe&&!iframe.contentWindow||typeof func==="function")){if(!queue)queue=this.callPlayer.queue[frame_id]=[];queue.push([func,args]);if(!("poller"in queue)){queue.poller=setInterval(function(){$this.callPlayer(frame_id,"listening")},250);messageEvent(1,function runOnceReady(e){if(!iframe){iframe=document.getElementById(frame_id);if(!iframe)return;if(iframe.tagName.toUpperCase()!="IFRAME"){iframe=iframe.getElementsByTagName("iframe")[0];if(!iframe)return}}if(e.source===iframe.contentWindow){clearInterval(queue.poller);queue.ready=true;messageEvent(0,runOnceReady);while(tmp=queue.shift()){$this.callPlayer(frame_id,tmp[0],tmp[1])}}},false)}}else if(iframe&&iframe.contentWindow){if(func.call)return func();iframe.contentWindow.postMessage(JSON.stringify({event:"command",func:func,args:args||[],id:frame_id}),"*")}function messageEvent(add,listener){var w3=add?window.addEventListener:window.removeEventListener;w3?w3("message",listener,!1):(add?window.attachEvent:window.detachEvent)("onmessage",listener)}}}},{"./MP.js":3}]},{},[1])(1)});
